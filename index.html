<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <title>A-Frame AR Hit Test - Criar Cubo</title>
        <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
        <style>
            body, html {
                margin: 0;
                height: 100%;
                overflow: hidden;
            }
        </style>
    </head>
    <body>
        <a-scene
            webxr="requiredFeatures: hit-test, local-floor; optionalFeatures: dom-overlay"
            ar-placement-controller
        >
            <a-camera></a-camera>

            <a-entity
                id="reticle"
                visible="false"
                geometry="primitive: ring; radiusInner: 0.05; radiusOuter: 0.06; segments-theta: 32"
                material="color: green; shader: flat"
                rotation="-90 0 0"
            ></a-entity>

            <a-entity light="type: directional; intensity: 0.8" position="1 2 1"></a-entity>
            <a-entity light="type: ambient; intensity: 0.3"></a-entity>
        </a-scene>

        <script>
            // Registra o componente 'ar-placement-controller' para gerenciar a lógica de AR.
            AFRAME.registerComponent('ar-placement-controller', {
                init: function () {
                    const scene = this.el; // A cena
                    const reticle = document.getElementById('reticle');

                    // Ouve o evento 'ar-hit-test-update' para atualizar a posição do reticle.
                    scene.addEventListener('ar-hit-test-update', (e) => {
                        const hit = e.detail.hit;
                        if (hit) {
                            // Se uma superfície foi encontrada, posiciona o reticle e o torna visível.
                            reticle.setAttribute('position', hit.position);
                            reticle.setAttribute('rotation', hit.rotation);
                            reticle.setAttribute('visible', true);
                        } else {
                            // Se nenhuma superfície foi encontrada, o reticle fica invisível.
                            reticle.setAttribute('visible', false);
                        }
                    });

                    // Ouve o evento 'click' para criar o cubo.
                    scene.addEventListener('click', (e) => {
                        // Verifica se o reticle está visível (se uma superfície válida foi encontrada).
                        if (!reticle.getAttribute('visible')) {
                            console.log("Não é possível criar o cubo. Reticle invisível.");
                            return;
                        }

                        // Cria um novo cubo
                        const cube = document.createElement('a-box');
                        const pos = reticle.getAttribute('position');

                        // Define os atributos do cubo (posição, tamanho, cor, sombra).
                        cube.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
                        cube.setAttribute('depth', 0.2);
                        cube.setAttribute('height', 0.2);
                        cube.setAttribute('width', 0.2);
                        cube.setAttribute('color', '#FFFF00');
                        cube.setAttribute('shadow', '');

                        // Adiciona o cubo à cena.
                        scene.appendChild(cube);
                        console.log("Cubo criado em:", pos);
                    });
                }
            });
        </script>
    </body>
</html>